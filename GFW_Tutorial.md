# 前言

> - 本篇关于相关`DNS`的简介。

# 关于GFW原理

-  `GFW`的内部工作原理是不公开的，所以大部分的都是前人的经验总结。

# DNS概述

- 前端经典面试题：『从浏览器输入`URL`之后，会发生什么？』

- 当你在浏览器中输入`https://www.baidu.com`时，浏览器并不能直接根据这串字符确定目标主机的地址。

- `baidu.com`被称为域名（`domain`），我们要真正访问到域名下的资源，需要首先进行域名解析，这就需要用到`DNS`（域名解析系统），获取到服务器的`IP`地址之后再向`IP`发送请求。
- 我们可以把`DNS`简单地理解为域名到`IP`的映射。通常`DNS`服务器由`ISP`运营商所提供的。

- 在`Windows`下，可以使用自带的 `nslookup` 命令进行`DNS`查询，附带`ping`命令：
  - 其中`DNS`服务器的域名为`ns5.gd.cnmobile.net`，`DNS`服务器的`IP`地址为：`211.136.192.6`，
  - 目标网站服务器的域名为`www.baidu.com`，目标网站的`IP`地址为`183.232.231.172`：

```reStructuredText
C:\Users\siyan>nslookup www.baidu.com
服务器:  ns5.gd.cnmobile.net
Address:  211.136.192.6

非权威应答:
名称:    www.a.shifen.com
Addresses:  183.232.231.174
          183.232.231.172
Aliases:  www.baidu.com

C:\Users\siyan>ping www.baidu.com

正在 Ping www.a.shifen.com [183.232.231.172] 具有 32 字节的数据:
来自 183.232.231.172 的回复: 字节=32 时间=5ms TTL=57
来自 183.232.231.172 的回复: 字节=32 时间=4ms TTL=57
来自 183.232.231.172 的回复: 字节=32 时间=4ms TTL=57
来自 183.232.231.172 的回复: 字节=32 时间=4ms TTL=57

183.232.231.172 的 Ping 统计信息:
    数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，
往返行程的估计时间(以毫秒为单位):
    最短 = 4ms，最长 = 5ms，平均 = 4ms
```

# HTTP & HTTPS

- `HTTP (Hypertext Transfer Protocol) `中文叫做超文本传输协议，从下图中可以看到，在平时所用的`TCP/IP`模型和`OSI`参考模型中都位于最上层，是离我们日常使用最近的协议啦。
- 大家看一下最下层的物理层，那是最接近硬件的一层了，那里有大家常常听说的以太网的协议。

![TCP-IP-model-vs-OSI-model](images/GFW_Tutorial.images/TCP-IP-model-vs-OSI-model-1599209147695.png)

- 每台主机有许多端口可以提供用来套接字服务，端口号在`[1, 65535]`之间。
  - 基础知识：`HTTP`的周知端口号是`80`，`HTTPS`的周知端口号是`443`。
  - 本地主机的回环测试地址为`127.0.0.1`或者`0.0.0.0`，`DNS`服务的周知端口号是`53`。
  - `1024`以下的端口号是系统端口号，在`Linux`中开启需要`root`权限。

- 由于`HTTP`的传输报文是明文，所以非常不安全，人门于是将`SSL(TLS)`和`HTTP`结合，在`HTTP`进入`TCP`报文段之前，先经过`SSL`对`HTTP`报文进行加密这就产生了`HTTPS`。

- 温馨提示：大家在访问网站的时候一定要尽量用`https`，推荐使用`Firefox`、`Chrome`这种现代化的浏览器，使用`IE`浏览器上网简直就是在裸奔，`IE`在安全性和`JS`新特性支持上都表现的很差劲，如今很多前端项目也逐渐放弃了对旧版本`IE`的支持，如`GitHub`上最火的前端项目`Bootstrap`等等。

# 网络无法访问的原因

## DNS 污染（DNS 欺骗）

- `DNS`污染`DNS Spoofing`又称为域名服务器缓存污染，英文为`DNS Cache Poisoning`。

- 由于全球只有`13`个顶级域名服务器，所以为了避免单点故障、减少查询压力等等会有各级缓存。如果你使用的是国外的`DNS`服务器，比如`Google`的 `8.8.8.8`，`DNS`查询需要经过国际出口。`GFW`会通过技术手段伪造`DNS`的查询结果，这样你查询到的`IP`地址并非域名的真实地址，也就会访问失败。

- 测试`DNS`是否被污染最佳工具是[China Firewall Test](http://www.chinafirewalltest.com/)。

## DNS 劫持

- `DNS`劫持和`DNS`污染是不同的，国内很多的`ISP`（`Internet Service Provider`，中国移动、中国电信、中国联通等等）会故意修改自己`DNS`服务器上的记录，把某些敏感网站的记录修改成错误的`IP`地址。

## IP 黑名单

- 顾名思义，在你请求某个`IP`地址时，如果其恰好在`GFW`的`IP`黑名单上，`GFW`会屏蔽这些报文，导致无法正常访问。

- 测试`IP`是否被墙的最佳工具是[站长工具 Ping 检测](http://ping.chinaz.com/)。

## 敏感词过滤

- `GFW`会维护一个敏感词列表，经常更新。如果你访问的网页中存在敏感词汇，`GFW`也会屏蔽。我们可以通过`Wireshark`抓包来测试，这里不再详细展开。